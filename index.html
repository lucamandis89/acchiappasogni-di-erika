<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acchiappasogni di Erika</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7c5cff">

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">‚ú®</div>
      <div>
        <div id="brandName" class="brand-title">Acchiappasogni di Erika</div>
        <div class="brand-sub">Catalogo ‚Ä¢ Ordina su WhatsApp</div>
      </div>
    </div>

    <div class="actions">
      <button id="btnDesigner" class="btn primary" style="font-weight:800;">
        üé® Personalizza il tuo Acchiappasogni
      </button>
      <button id="btnCustom" class="btn ghost">Personalizzato</button>
      <button id="btnSettings" class="btn ghost">Impostazioni</button>
      <button id="btnCart" class="btn">
        Carrello <span id="cartCount" class="badge">0</span>
      </button>
    </div>
  </header>

  <main class="container">
    <section class="search">
      <input id="search" type="search" placeholder="Cerca (nome o descrizione)..." autocomplete="off" />
    </section>

    <section class="tabs-wrap">
      <div id="tabs" class="tabs"></div>
    </section>

    <section id="grid" class="grid" aria-live="polite"></section>
  </main>

  <!-- CARRELLO -->
  <div id="drawerBackdrop" class="backdrop hidden"></div>

  <aside id="drawer" class="drawer hidden" aria-hidden="true">
    <div class="drawer-header">
      <div class="drawer-title">Carrello</div>
      <button id="btnCloseCart" class="btn ghost">Chiudi</button>
    </div>

    <div id="cartItems" class="cart-items"></div>

    <div class="totals">
      <div class="row"><span>Subtotale</span><span id="subtotal">‚Ç¨ 0,00</span></div>
      <div class="row"><span>Spedizione</span><span id="shipping">‚Ç¨ 0,00</span></div>
      <div class="row total"><span>Totale</span><span id="total">‚Ç¨ 0,00</span></div>
      <div class="hint" id="shippingHint"></div>
    </div>

    <div class="checkout">
      <div class="section-title">Dati ordine</div>

      <label class="field">
        <span>Nome e cognome</span>
        <input id="name" type="text" placeholder="Es. Mario Rossi" />
      </label>

      <div class="radios">
        <label><input type="radio" name="delivery" value="shipping" checked /> Spedizione</label>
        <label><input type="radio" name="delivery" value="pickup" /> Ritiro / consegna a mano</label>
      </div>

      <div id="shippingFields">
        <label class="field">
          <span>Via / indirizzo</span>
          <input id="street" type="text" placeholder="Via..." />
        </label>

        <div class="two">
          <label class="field">
            <span>CAP</span>
            <input id="cap" type="text" inputmode="numeric" placeholder="090..." />
          </label>

          <label class="field">
            <span>Citt√†</span>
            <input id="city" type="text" placeholder="Citt√†..." />
          </label>
        </div>
      </div>

      <label class="field">
        <span>Note (colore, personalizzazione, ecc.)</span>
        <textarea id="notes" rows="3" placeholder="Scrivi qui..."></textarea>
      </label>

      <button id="btnSend" class="btn primary">Invia ordine su WhatsApp</button>
      <button id="btnClear" class="btn danger">Annulla ordine (svuota carrello)</button>

      <p class="small">
        Pagamento e spedizione vengono gestiti fuori dal sito. Riceverai conferma su WhatsApp.
      </p>
    </div>
  </aside>

  <!-- IMPOSTAZIONI -->
  <div id="settingsBackdrop" class="backdrop hidden"></div>

  <aside id="settingsModal" class="drawer hidden" aria-hidden="true">
    <div class="drawer-header">
      <div class="drawer-title">Impostazioni (Admin)</div>
      <button id="btnCloseSettings" class="btn ghost">Chiudi</button>
    </div>

    <div style="padding:12px;">
      <div id="settingsLocked">
        <div class="section-title">Accesso</div>
        <label class="field">
          <span>Password</span>
          <input id="adminPass" type="password" placeholder="Inserisci password..." />
        </label>
        <button id="btnUnlock" class="btn primary">Entra</button>
        <p class="small" style="margin-top:8px;">Accesso richiesto per modificare prodotti e prezzi.</p>
      </div>

      <div id="settingsPanel" class="hidden">
        <hr style="margin:14px 0; opacity:.2;" />
        <div class="section-title">Sincronizzazione (GitHub Pages)</div>

        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button id="btnExportJson" class="btn primary">Esporta JSON (copia)</button>
          <button id="btnImportJson" class="btn small">Importa JSON (incolla)</button>
          <button id="btnReloadFromSite" class="btn small">Ricarica dal sito</button>
        </div>

        <p class="small" style="margin-top:8px;">
          Per far vedere i nuovi prodotti a tutti, incolla l‚Äôexport nel file <b>data/products.json</b> su GitHub.
        </p>

        <hr style="margin:14px 0; opacity:.2;" />
        <div class="section-title">Sicurezza</div>

        <label class="field">
          <span>Nuova password</span>
          <input id="newAdminPass" type="password" placeholder="Scrivi nuova password..." />
        </label>

        <label class="field">
          <span>Conferma password</span>
          <input id="newAdminPass2" type="password" placeholder="Ripeti nuova password..." />
        </label>

        <button id="btnChangePass" class="btn primary">Cambia password</button>

        <hr style="margin:14px 0; opacity:.2;" />
        <div class="section-title">Ordinamento prodotti</div>

        <label class="field">
          <span>Ordina per</span>
          <select id="sortMode">
            <option value="featured">In evidenza (default)</option>
            <option value="newest">Pi√π recenti</option>
            <option value="title">Titolo (A-Z)</option>
            <option value="priceAsc">Prezzo (crescente)</option>
            <option value="priceDesc">Prezzo (decrescente)</option>
          </select>
        </label>

        <button id="btnApplySort" class="btn primary">Applica ordinamento</button>

        <hr style="margin:14px 0; opacity:.2;" />
        <div class="section-title">Aggiungi nuovo progetto</div>

        <label class="field">
          <span>Titolo</span>
          <input id="newTitle" type="text" placeholder="Es. Acchiappasogni - Modello 123" />
        </label>

        <label class="field">
          <span>Categoria</span>
          <input id="newCategory" type="text" placeholder="Es. Acchiappasogni Classici" />
        </label>

        <label class="field">
          <span>Prezzo (‚Ç¨)</span>
          <input id="newPrice" type="number" step="0.01" placeholder="Es. 5" />
        </label>

        <label class="field">
          <span>Descrizione</span>
          <textarea id="newDesc" rows="3" placeholder="Descrizione..."></textarea>
        </label>

        <div class="field">
          <span>Immagine</span>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
            <button id="btnPickImageNew" class="btn small">Scegli immagine</button>
            <button id="btnTakePhotoNew" class="btn small">Scatta foto</button>
            <button id="btnClearImageNew" class="btn danger small">Rimuovi</button>
          </div>
          <input id="newImage" type="text" placeholder="(si compila da solo scegliendo/scattando)" style="margin-top:8px;" />
          <img id="newImagePreview" alt="Anteprima" style="margin-top:10px; width:100%; max-height:220px; object-fit:cover; border-radius:12px; display:none;" />
        </div>

        <label style="display:flex; gap:8px; align-items:center; margin:10px 0;">
          <input id="newFeatured" type="checkbox" />
          <span>In evidenza</span>
        </label>

        <button id="btnAddProduct" class="btn primary">Aggiungi progetto</button>

        <hr style="margin:14px 0; opacity:.2;" />
        <div class="section-title">Modifica / Duplica / Elimina</div>
        <div id="adminList"></div>

        <div style="display:flex; gap:8px; margin-top:12px;">
          <button id="btnSaveAll" class="btn primary" style="flex:1;">Salva modifiche</button>
          <button id="btnResetAll" class="btn danger" style="flex:1;">Ripristina default</button>
        </div>

        <p class="small" style="margin-top:10px;">
          ‚ÄúSalva modifiche‚Äù salva sul tuo telefono. ‚ÄúEsporta JSON‚Äù serve per aggiornare GitHub e farlo vedere a tutti.
        </p>
      </div>
    </div>
  </aside>

  <!-- CONFIGURATORE ACCHIAPPASOGNI -->
  <div id="designerBackdrop" class="backdrop hidden"></div>

  <aside id="designerModal" class="drawer hidden" aria-hidden="true">
    <div class="drawer-header">
      <div class="drawer-title">Personalizza il tuo Acchiappasogni</div>
      <button id="btnCloseDesigner" class="btn ghost">Chiudi</button>
    </div>

    <div style="padding:12px;">
      <div class="section-title">Idee gi√† composte (modificabili)</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin:10px 0;">
        <button id="presetBase" class="btn small">Classico</button>
        <button id="presetPhoto" class="btn small">Stile foto (scritta + AA)</button>
        <button id="presetRomantic" class="btn small">Cuore</button>
        <button id="presetMoon" class="btn small">Luna</button>
        <button id="presetStar" class="btn small">Stella</button>
      </div>

      <div class="section-title">Strumenti (tocca l‚Äôanteprima per aggiungere)</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin:10px 0;">
        <button id="toolBead" class="btn small">Perlina</button>
        <button id="toolGlitter" class="btn small">Brillantino</button>
        <button id="toolSymbol" class="btn small">Simbolo</button>
        <button id="toolMiniFeather" class="btn small">Piumetta</button>
        <button id="toolUndo" class="btn danger small">Annulla</button>
      </div>
      <p class="small" style="margin-top:-4px; color:var(--muted);">
        Consiglio: seleziona uno strumento e poi tocca sull‚Äôimmagine per piazzarlo.
      </p>

      <div class="section-title">Anteprima</div>
      <div style="border:1px solid rgba(0,0,0,.12); border-radius:16px; overflow:hidden; margin-top:8px;">
        <canvas id="designerCanvas" style="width:100%; height:360px; display:block; background:#fff;"></canvas>
      </div>

      <div class="section-title" style="margin-top:12px;">Componenti e variabili</div>

      <div style="display:grid; gap:10px; margin-top:8px;">
        <label class="field" style="margin:0;">
          <span>Diametro (cm)</span>
          <input id="optDiameter" type="range" min="12" max="60" value="35">
        </label>

        <label class="field" style="margin:0;">
          <span>Numero piume</span>
          <input id="optFeathers" type="range" min="1" max="7" value="3">
        </label>

        <label class="field" style="margin:0;">
          <span>Lunghezza piume</span>
          <input id="optFeatherLen" type="range" min="40" max="140" value="95">
        </label>

        <label class="field" style="margin:0;">
          <span>Spessore cerchi</span>
          <input id="optRingWidth" type="range" min="2" max="10" value="5">
        </label>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <label class="field" style="margin:0; min-width:150px;">
            <span>Colore cerchi</span>
            <input id="colRings" type="color" value="#222222">
          </label>
          <label class="field" style="margin:0; min-width:150px;">
            <span>Colore rete</span>
            <input id="colWeb" type="color" value="#222222">
          </label>
          <label class="field" style="margin:0; min-width:150px;">
            <span>Colore piume</span>
            <input id="colFeathers" type="color" value="#333333">
          </label>
          <label class="field" style="margin:0; min-width:150px;">
            <span>Colore perline</span>
            <input id="colBeads" type="color" value="#b50000">
          </label>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <label style="display:flex; gap:8px; align-items:center;">
            <input id="optBeadsOn" type="checkbox" checked>
            <span>Perline</span>
          </label>
          <label class="field" style="margin:0; min-width:180px;">
            <span>Quantit√† perline</span>
            <input id="optBeadsQty" type="range" min="0" max="30" value="10">
          </label>
          <label style="display:flex; gap:8px; align-items:center;">
            <input id="optGlitter" type="checkbox">
            <span>Brillantini</span>
          </label>
        </div>

        <label class="field" style="margin:0;">
          <span>Scritta sopra (opzionale)</span>
          <input id="optTextTop" type="text" placeholder="Es. REAL HASTA LA MUERTE">
        </label>

        <label class="field" style="margin:0;">
          <span>Colore scritta</span>
          <input id="colText" type="color" value="#b50000">
        </label>

        <label class="field" style="margin:0;">
          <span>Simbolo centrale</span>
          <select id="optSymbol">
            <option value="none">Nessuno</option>
            <option value="AA">AA (come foto)</option>
            <option value="heart">Cuore</option>
            <option value="moon">Luna</option>
            <option value="star">Stella</option>
          </select>
        </label>

        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <label style="display:flex; gap:8px; align-items:center;">
            <input id="optCharms" type="checkbox" checked>
            <span>Charms laterali (come foto)</span>
          </label>
          <label class="field" style="margin:0; min-width:180px;">
            <span>Grandezza charms</span>
            <input id="optCharmSize" type="range" min="18" max="60" value="34">
          </label>
        </div>

        <label class="field" style="margin:0;">
          <span>Nome (facoltativo)</span>
          <input id="designerName" type="text" placeholder="Es. Maria">
        </label>

        <label class="field" style="margin:0;">
          <span>Note (facoltative)</span>
          <textarea id="designerNotes" rows="3" placeholder="Colore preferito, dimensioni, dettagli..."></textarea>
        </label>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:4px;">
          <button id="btnSendDesign" class="btn primary" style="flex:1;">Invia progetto su WhatsApp</button>
          <button id="btnDownloadDesign" class="btn small" style="flex:1;">Scarica immagine</button>
        </div>

        <p class="small" id="designerHint" style="margin-top:6px;"></p>
      </div>
    </div>
  </aside>

  <script src="app.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js");
    }
  </script>
</body>
</html>
